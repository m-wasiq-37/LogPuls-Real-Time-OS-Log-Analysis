<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LogPuls Login</title>
<link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="loginwrap">
<form id="loginForm" autocomplete="off">
<h2>Sign in</h2>
<label>
<input id="u" name="username" placeholder="Username" required>
</label>
<label>
<input id="p" name="password" type="password" placeholder="Password" required>
</label>
<button id="loginBtn" type="submit" class="btn primary">Login</button>
<p id="err" class="error" role="status"></p>
</form>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("loginForm");
  const err = document.getElementById("err");
  const btn = document.getElementById("loginBtn");
  form.addEventListener("submit", async e => {
    e.preventDefault();
    err.textContent = "";
    btn.disabled = true;
    const u = document.getElementById("u").value.trim();
    const p = document.getElementById("p").value;
    try {
      const res = await fetch('/auth/login', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({username: u, password: p})
      });
      if (!res.ok) {
        const j = await res.json().catch(()=>({detail:'Login failed'}));
        err.textContent = j.detail || 'Login failed';
        btn.disabled = false;
        return;
      }
      const j = await res.json();
      localStorage.setItem('lp_token', j.access_token);
      location.href = '/dashboard.html';
    } catch (errx) {
      err.textContent = 'Network error. Is Docker running?';
      btn.disabled = false;
    }
  });
});
</script>
</body>
</html>
